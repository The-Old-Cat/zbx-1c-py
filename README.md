# zbx-1c-py

–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Zabbix.

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ 1–° (LLD - Low Level Discovery)
- –°–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ —Å–µ—Å—Å–∏–π –∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–∑
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RAS (Remote Administration Service)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Zabbix —á–µ—Ä–µ–∑ UserParameter

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ 1–° (LLD)
- ‚úÖ –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫: —Å–µ—Å—Å–∏–∏, –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏, —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–∑ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RAS —Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ 1–°
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `loguru` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —É—Ä–æ–≤–Ω—è
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `.env`
- ‚úÖ REST API –Ω–∞ FastAPI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å (Windows, Linux, macOS)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
zbx-1c-py/
‚îú‚îÄ‚îÄ src/zbx_1c/                  # –ì–ª–∞–≤–Ω—ã–π –ø–∞–∫–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ __main__.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: python -m zbx_1c
‚îÇ   ‚îú‚îÄ‚îÄ api/                     # REST API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py              # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.py            # –ú–∞—Ä—à—Ä—É—Ç—ã API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ API
‚îÇ   ‚îú‚îÄ‚îÄ cli/                     # CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands.py          # –ö–æ–º–∞–Ω–¥—ã CLI
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ zabbix_config.py     # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Zabbix
‚îÇ   ‚îú‚îÄ‚îÄ core/                    # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Settings)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py        # –ò—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging.py           # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py            # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ monitoring/              # –ú–æ–¥—É–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cluster/             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manager.py       # ClusterManager
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ discovery.py     # –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ infobase/            # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–∞–∑—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ finder.py        # –ü–æ–∏—Å–∫ –ò–ë
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analyzer.py      # –ê–Ω–∞–ª–∏–∑ –Ω–∞–≥—Ä—É–∑–∫–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ monitor.py       # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ò–ë
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session/             # –°–µ—Å—Å–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ collector.py     # –°–±–æ—Ä —Å–µ—Å—Å–∏–π + CLI
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ filters.py       # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jobs/                # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ reader.py        # –ß—Ç–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ utils/                   # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ rac_client.py        # RAC –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îú‚îÄ‚îÄ converters.py        # –ü–∞—Ä—Å–∏–Ω–≥ –≤—ã–≤–æ–¥–∞ rac
‚îÇ       ‚îú‚îÄ‚îÄ fs.py                # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
‚îÇ       ‚îî‚îÄ‚îÄ net.py               # –°–µ—Ç–µ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ tests/                       # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ scripts/                     # –°–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ data/                        # –î–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ docs/                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ logs/                        # –õ–æ–≥–∏
‚îú‚îÄ‚îÄ zabbix/                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Zabbix
‚îÇ   ‚îú‚îÄ‚îÄ templates/               # –®–∞–±–ª–æ–Ω—ã Zabbix
‚îÇ   ‚îî‚îÄ‚îÄ userparameter_1c.conf    # UserParameter –¥–ª—è Zabbix Agent
‚îú‚îÄ‚îÄ .env.example                 # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ pyproject.toml               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ LICENSE
```

---

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- –£—Ç–∏–ª–∏—Ç–∞ `rac` / `rac.exe` (Remote Administration Console) –¥–ª—è 1–°
- –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è 1–° (RAS)
- –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ 1–° (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ uv (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
uv sync

# –ò–ª–∏ —á–µ—Ä–µ–∑ pip
pip install -e .

# –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pip install -e ".[dev]"
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:

```bash
cp .env.example .env
```

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`, —É–∫–∞–∑–∞–≤ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è:

```env
# –ü—É—Ç—å –∫ —É—Ç–∏–ª–∏—Ç–µ rac (—Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –û–°)
# Windows:
RAC_PATH=C:/Program Files/1cv8/x.x.x.x/bin/rac.exe
# Linux:
# RAC_PATH=/opt/1C/v8.3/x.x.x.x/rac
# macOS:
# RAC_PATH=/Applications/1C/Enterprise Platform/x.x.x.x/rac

# –•–æ—Å—Ç –∏ –ø–æ—Ä—Ç RAS-—Å–µ—Ä–≤–∏—Å–∞
RAC_HOST=127.0.0.1
RAC_PORT=1545

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
USER_NAME=admin
USER_PASS=password

# –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
LOG_PATH=./logs

# –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
DEBUG=False

# –¢–∞–π–º–∞—É—Ç—ã (—Å–µ–∫—É–Ω–¥—ã)
RAC_TIMEOUT=30
COMMAND_TIMEOUT=60

# –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ (—Å–µ–∫—É–Ω–¥—ã)
CACHE_TTL=300
```

---

## ‚ñ∂Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### CLI –∫–æ–º–∞–Ω–¥—ã

#### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ entry points (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `pip install -e .` –¥–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã:

```bash
zbx-1c <command> [options]
zbx-1c-discovery
zbx-1c-metrics <cluster_id>
zbx-1c-test
```

#### –ó–∞–ø—É—Å–∫ –∫–∞–∫ –º–æ–¥—É–ª—å

```bash
python -m zbx_1c <command> [options]
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `check-ras` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RAS —Å–µ—Ä–≤–∏—Å–∞ |
| `discovery` | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –¥–ª—è Zabbix LLD |
| `clusters` | –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ |
| `infobases <cluster_id>` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| `sessions <cluster_id>` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| `jobs <cluster_id>` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| `metrics [cluster_id]` | –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ (–¥–ª—è Zabbix) |
| `all <cluster_id>` | –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Ç–µ—Ä–µ |
| `test` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RAS
python -m zbx_1c check-ras

# –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (JSON –¥–ª—è Zabbix LLD)
python -m zbx_1c discovery

# –°–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
python -m zbx_1c clusters

# –°–ø–∏—Å–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
python -m zbx_1c clusters --json-output

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–∞–∑—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
python -m zbx_1c infobases f93863ed-3fdb-4e01-a74c-e112c81b053b

# –°–µ—Å—Å–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
python -m zbx_1c sessions f93863ed-3fdb-4e01-a74c-e112c81b053b

# –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
python -m zbx_1c jobs f93863ed-3fdb-4e01-a74c-e112c81b053b

# –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Zabbix
python -m zbx_1c metrics f93863ed-3fdb-4e01-a74c-e112c81b053b

# –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
python -m zbx_1c metrics

# –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Ç–µ—Ä–µ
python -m zbx_1c all f93863ed-3fdb-4e01-a74c-e112c81b053b

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
python -m zbx_1c test
```

### CLI –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–µ—Å—Å–∏–π

–ú–æ–¥—É–ª—å —Å–µ—Å—Å–∏–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π
python -m zbx_1c.monitoring.session.collector list <cluster_id>

# –°–ø–∏—Å–æ–∫ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
python -m zbx_1c.monitoring.session.collector list <cluster_id> --json-output

# –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç)
python -m zbx_1c.monitoring.session.collector active <cluster_id>

# –° –ø–æ—Ä–æ–≥–æ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–≤ –º–∏–Ω—É—Ç–∞—Ö)
python -m zbx_1c.monitoring.session.collector active <cluster_id> --threshold 10

# –°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏—è—Ö
python -m zbx_1c.monitoring.session.collector summary <cluster_id>

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π (–¥–ª—è Zabbix)
python -m zbx_1c.monitoring.session.collector count <cluster_id>
```

### REST API

–ó–∞–ø—É—Å–∫ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```bash
uvicorn zbx_1c.api.main:app --reload --host 0.0.0.0 --port 8000
```

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/` | –ö–æ—Ä–Ω–µ–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç |
| GET | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| GET | `/clusters/discovery` | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (LLD) |
| GET | `/clusters` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ |
| GET | `/clusters/{cluster_id}/metrics` | –ú–µ—Ç—Ä–∏–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| GET | `/clusters/{cluster_id}/sessions` | –°–µ—Å—Å–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| GET | `/clusters/{cluster_id}/jobs` | –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ |
| GET | `/ras/status` | –°—Ç–∞—Ç—É—Å RAS —Å–µ—Ä–≤–∏—Å–∞ |

---

## üìä –°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞

- `zbx1cpy.cluster.total_sessions` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π
- `zbx1cpy.cluster.active_sessions` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- `zbx1cpy.cluster.total_jobs` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π
- `zbx1cpy.cluster.active_jobs` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π
- `zbx1cpy.cluster.total_infobases` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–∑

### –ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Å—Å–∏–π

- Session ID
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Designer, 1CV8C, –∏ —Ç.–¥.)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞
- –•–æ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–µ—Å—Å–∏–∏
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –°—Ç–∞—Ç—É—Å (hibernate)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–∑–æ–≤–æ–≤ –∏ —Ç—Ä–∞—Ñ–∏–∫–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–∑

- –ò–º—è –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –ò–ë
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π (–≤—Å–µ–≥–æ/–∞–∫—Ç–∏–≤–Ω—ã—Ö)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –¢–∏–ø—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–æ–≤
- –û–±—ä–µ–º —Ç—Ä–∞—Ñ–∏–∫–∞
- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
- –ë–ª–æ—Ä–æ–≤–∫–∏

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Zabbix

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Zabbix Agent

#### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞

```bash
pip install -e .
```

#### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ UserParameter

```bash
python scripts/generate_userparam_config.py
```

#### 3. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**Windows (–æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞):**
```powershell
Copy-Item "zabbix\userparameters\userparameter_1c.conf" `
    -Destination "C:\Program Files\Zabbix Agent 2\zabbix_agent2.d\" -Force
```

**Linux:**
```bash
sudo cp zabbix/userparameters/userparameter_1c.conf /etc/zabbix/zabbix_agentd.d/
```

#### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Zabbix Agent

**Windows:**
```powershell
Restart-Service "Zabbix Agent 2"
```

**Linux:**
```bash
sudo systemctl restart zabbix-agent
```

#### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# Windows
& "C:\Program Files\Zabbix Agent 2\zabbix_get.exe" -s localhost -k "zbx1cpy.test"
& "C:\Program Files\Zabbix Agent 2\zabbix_get.exe" -s localhost -k "zbx1cpy.clusters.discovery"
& "C:\Program Files\Zabbix Agent 2\zabbix_get.exe" -s localhost -k "zbx1cpy.metrics[<cluster_id>]"

# Linux
zabbix_get -s localhost -k "zbx1cpy.test"
zabbix_get -s localhost -k "zbx1cpy.clusters.discovery"
zabbix_get -s localhost -k "zbx1cpy.metrics[<cluster_id>]"
```

### UserParameter

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è entry points):

```conf
# Discovery: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (LLD)
UserParameter=zbx1cpy.clusters.discovery,zbx-1c-discovery

# Metrics: —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –∫–ª–∞—Å—Ç–µ—Ä–∞ ($1)
UserParameter=zbx1cpy.metrics[*],zbx-1c-metrics $1

# –¢–µ—Å—Ç–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
UserParameter=zbx1cpy.test,zbx-1c-test
```

### –ò–º–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–∞ Zabbix

1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω –∏–∑ `zabbix/templates/template.xml`
2. –°–≤—è–∂–∏—Ç–µ —à–∞–±–ª–æ–Ω —Å —Ö–æ—Å—Ç–æ–º
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–∞–∫—Ä–æ—Å—ã (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ LLD (Low Level Discovery) —Å –∫–ª—é—á–æ–º `zbx1cpy.clusters.discovery`.

---

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=zbx_1c

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/test_basic.py -v
```

---

## üì¶ –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
python -m build

# –ò–ª–∏ —á–µ—Ä–µ–∑ uv
uv build
```

---

## üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
# –ê—É–¥–∏—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
pip-audit

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
ruff check src
pyright src
```

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE)

---

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É (`git checkout -b feature/amazing-feature`)
3. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add amazing feature'`)
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (`git push origin feature/amazing-feature`)
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `logs/`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å —Ñ–ª–∞–≥–æ–º `DEBUG=True` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `test` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
python -m zbx_1c test
```
