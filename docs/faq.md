# Часто задаваемые вопросы (FAQ)

## Общие вопросы

### Что такое zbx-1c-py?
zbx-1c-py - это кроссплатформенный инструмент для интеграции 1С:Предприятия с системой мониторинга Zabbix. Он позволяет собирать информацию о кластерах 1С, сессиях пользователей и фоновых заданиях через сервер администрирования кластера (RAC) и передавать эти данные в Zabbix для последующего мониторинга и анализа. Проект работает на Windows, Linux и macOS.

### Какие версии 1С поддерживаются?
Проект работает с любыми версиями 1С:Предприятия, которые поддерживают RAS (Remote Administration Service) и утилиту rac. Обычно это версии 8.3.10 и выше. Утилита rac доступна в разных версиях для разных операционных систем.

### Какие метрики собираются?
- Общее количество сессий
- Количество активных сессий (реально работающие пользователи)
- Количество активных фоновых заданий
- Статус доступности RAS-сервиса
- Информация о кластерах (ID, имя)

## Установка и настройка

### Как установить проект?
1. Установите uv (Python не обязателен, uv может управлять версиями Python)
2. Клонируйте репозиторий
3. Выполните `uv sync` для установки зависимостей в изолированное окружение
4. Настройте файл .env с параметрами подключения к 1С
5. Проверьте работу с помощью `uv run src/zbx_1c_py/main.py --check-ras`

### Как проект изолирован от системного Python?
Проект полностью изолирован от системного Python через использование uv:
- Все зависимости устанавливаются в виртуальное окружение uv
- Запуск осуществляется через `uv run`, что гарантирует использование изолированной среды
- Версии пакетов фиксируются в файле `uv.lock` для воспроизводимости
- Не требуется установка Python в систему (uv может устанавливать нужную версию автоматически)

### Где найти путь к rac?
Обычно rac находится в составе платформы 1С:Предприятия:
- Windows: `C:/Program Files/1cv8/x.x.x.x/rac.exe` (где x.x.x.x - номер версии)
- Linux: `/opt/1C/v8.3/x.x.x.x/rac` (где x.x.x.x - номер версии)
- macOS: `/Applications/1C/Enterprise Platform/x.x.x.x/rac`

### Как получить ID кластера 1С?
ID кластера (UUID) можно получить несколькими способами:
1. Через конфигуратор: Сервис → Параметры кластера
2. Через rac: `rac cluster list`
3. Автоматически через `--discovery` режим: `python main.py --discovery`

## Работа с Zabbix

### Как настроить в Zabbix?
1. Добавьте UserParameter в конфигурацию Zabbix Agent
2. Создайте шаблон с LLD правилом для обнаружения кластеров
3. Настройте прототипы элементов данных для сбора метрик
4. Привяжите шаблон к хосту в Zabbix

### Что делать, если Zabbix не может выполнить команду?
1. Проверьте права доступа к файлу main.py
2. Убедитесь, что пользователь zabbix может выполнить команду
3. Проверьте путь к интерпретатору python в UserParameter
4. Убедитесь, что все зависимости установлены в окружении пользователя zabbix
5. Проверьте, что исполняемый файл rac доступен в системе

### Как часто обновляются данные?
По умолчанию рекомендуется интервал обновления:
- Метрики сессий и заданий: 30-60 секунд
- Статус кластера: 1-5 минут
- LLD (обнаружение кластеров): 10-30 минут

## Кроссплатформенные вопросы

### Какие различия между операционными системами?
- **Windows**: исполняемый файл `rac.exe`, пути с обратными слэшами или прямыми слэшами
- **Linux**: исполняемый файл `rac`, права доступа к файлам через chmod
- **macOS**: исполняемый файл `rac`, пути в стиле Unix

### Как настроить проект на Windows?
1. Убедитесь, что путь к rac.exe указан правильно
2. Проверьте права доступа к файлам
3. Убедитесь, что пользователь Zabbix Agent может выполнить команду

### Как настроить проект на Linux?
1. Убедитесь, что исполняемый файл rac имеет права на выполнение: `chmod +x /path/to/rac`
2. Проверьте права доступа к файлам конфигурации
3. Убедитесь, что пользователь zabbix может получить доступ к исполняемому файлу

### Как настроить проект на macOS?
1. Убедитесь, что 1С установлена и доступна
2. Проверьте права доступа к исполняемому файлу rac
3. Убедитесь, что все зависимости Python установлены корректно

## Проблемы и решения

### Ошибка "File not found: rac" (или rac.exe)
**Причина**: Неверный путь к исполняемому файлу rac в настройках
**Решение**: 
1. Проверьте путь в RAC_PATH в файле .env
2. Убедитесь, что файл существует и доступен для чтения
3. Проверьте права доступа к файлу
4. Убедитесь, что исполняемый файл соответствует операционной системе

### Ошибка "Connection refused" при проверке RAS
**Причина**: RAS-сервис недоступен или неправильные настройки подключения
**Решение**:
1. Проверьте RAC_HOST и RAC_PORT в .env
2. Убедитесь, что RAS-сервис запущен на сервере 1С
3. Проверьте сетевое подключение к серверу 1С
4. Проверьте брандмауэр и правила доступа

### Все сессии показываются как неактивные
**Причина**: Неправильное определение активности сессий
**Решение**:
1. Проверьте логи на наличие ошибок
2. Убедитесь, что в данных присутствуют поля hibernate, last-active-at
3. Проверьте формат даты в поле last-active-at
4. Возможно, потребуется настроить порог активности (threshold_minutes)

### Высокая нагрузка на сервер 1С
**Причина**: Частые опросы или большое количество кластеров
**Решение**:
1. Увеличьте интервалы опроса в Zabbix
2. Проверьте, не происходит ли одновременного опроса нескольких кластеров
3. Оптимизируйте количество собираемых метрик

## Технические вопросы

### Как определяется "активная сессия"?
Активная сессия определяется по нескольким критериям:
1. Сессия не в спящем режиме (hibernate != 'yes')
2. Последняя активность была менее threshold_minutes минут назад (по умолчанию 5 минут)
3. Есть фактическая активность за последние 5 минут (calls-last-5min > 0 или bytes-last-5min > 0)

### Как определяется "активное фоновое задание"?
Активное фоновое задание должно соответствовать:
1. Состоянию 'active' (state == 'active')
2. Длительности выполнения не более max_duration_minutes (по умолчанию 60 минут)
3. Корректному времени начала выполнения

### Можно ли использовать без аутентификации?
Да, проект может работать без аутентификации, если RAS-сервис настроен на анонимный доступ. Однако рекомендуется использовать учетные данные для безопасности.

## Производительность

### Как влияет на производительность сервера 1С?
Проект использует минимальные ресурсы:
- Кратковременные запросы к RAS
- Оптимизированные таймауты
- Эффективный парсинг данных
- Минимальное количество обращений к серверу

### Как масштабируется решение?
- Поддерживает несколько кластеров 1С
- Автоматическое обнаружение новых кластеров
- Независимый опрос каждого кластера
- Поддержка распределенного мониторинга

## Безопасность

### Где хранить учетные данные?
Учетные данные должны храниться в файле .env в корне проекта. Не храните их в коде или в системе контроля версий.

### Как защитить от несанкционированного доступа?
1. Ограничьте права доступа к файлам проекта
2. Используйте отдельного пользователя с минимальными правами
3. Настройте брандмауэр для ограничения доступа к RAS
4. Регулярно меняйте пароли
5. Учитывайте особенности безопасности каждой операционной системы

## Обновления и поддержка

### Как обновить проект?
1. Сделайте резервную копию конфигурации
2. Выполните `git pull` для получения последних изменений
3. Обновите зависимости: `uv sync --upgrade`
4. Проверьте работоспособность: `uv run src/zbx_1c_py/main.py --check-ras`
5. Запустите тесты: `uv run pytest`

### Где получить поддержку?
- Файлы документации в папке docs/
- Файл README.md с описанием функциональности
- Используйте систему issue-трекинга репозитория (если доступна)
- Обратитесь к внутренним документам вашей организации

## Отладка

### Как включить режим отладки?
Установите DEBUG=true в файле .env:
```env
DEBUG=true
```

### Где находятся логи?
Логи создаются в директории, указанной в LOG_PATH в файле .env. По умолчанию:
- `logs/1c_clusters.log` - логи модуля clusters
- `logs/1c_monitoring.log` - логи основного модуля

### Как протестировать работу вручную?
```bash
# Проверить доступность RAS
python main.py --check-ras

# Получить список кластеров
python main.py --discovery

# Получить метрики для конкретного кластера
python main.py <cluster_id>
```