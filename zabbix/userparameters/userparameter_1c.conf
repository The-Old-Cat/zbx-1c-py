# ===========================================
# Для Windows (Zabbix Agent 2)
# ===========================================
# Сгенерировано: 2026-02-17 14:05:48
# OS: Windows
# Zabbix Agent: agent
# Project root: g:\Automation\zbx-1c-py
# Режим: Entry Points (zbx-1c-*)
# Python: g:\Automation\zbx-1c-py\.venv\Scripts\python.exe
# ===========================================
# Установка:
#   Windows: Копировать в C:\Program Files\Zabbix Agent 2\zabbix_agent2.d\
#   Linux:   Копировать в C:\Program Files\Zabbix Agent 2\zabbix_agent2.d\
#
# Перезапуск агента:
#   Restart-Service zabbix-agent2
#
# Проверка:
#   zabbix_get -s <host> -k zbx1cpy.clusters.discovery
# ===========================================

# ===========================================
# UserParameter для мониторинга кластеров 1С
# ===========================================
# Mode: Python Module с полным путём
# ===========================================

# LLD Discovery: обнаружение кластеров
UserParameter=zbx1cpy.clusters.discovery,cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c discovery

# Статус кластера: available | unavailable | unknown
UserParameter=zbx1cpy.cluster.status[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c status $1

# Метрики кластера (сессии, задания)
UserParameter=zbx1cpy.metrics[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics $1

# Метрики всех кластеров (для Master Item)
UserParameter=zbx1cpy.metrics.all,cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics

# Проверка доступности RAS
UserParameter=zbx1cpy.ras.check,cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c check-ras

# Тестовый параметр
UserParameter=zbx1cpy.test,cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c test

# Новые метрики (прямые запросы)
UserParameter=zbx1cpy.cluster.total_sessions[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics $1 | "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -c "import sys,json; d=json.load(sys.stdin); print(d.get('metrics',{}).get('total_sessions',0))"

UserParameter=zbx1cpy.cluster.active_sessions[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics $1 | "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -c "import sys,json; d=json.load(sys.stdin); print(d.get('metrics',{}).get('active_sessions',0))"

UserParameter=zbx1cpy.cluster.total_jobs[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics $1 | "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -c "import sys,json; d=json.load(sys.stdin); print(d.get('metrics',{}).get('total_jobs',0))"

UserParameter=zbx1cpy.cluster.active_bg_jobs[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics $1 | "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -c "import sys,json; d=json.load(sys.stdin); print(d.get('metrics',{}).get('active_jobs',0))"

UserParameter=zbx1cpy.cluster.session_limit[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics $1 | "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -c "import sys,json; d=json.load(sys.stdin); print(d.get('metrics',{}).get('session_limit',0))"

UserParameter=zbx1cpy.cluster.session_percent[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics $1 | "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -c "import sys,json; d=json.load(sys.stdin); print(d.get('metrics',{}).get('session_percent',0))"

UserParameter=zbx1cpy.cluster.working_servers[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics $1 | "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -c "import sys,json; d=json.load(sys.stdin); print(d.get('metrics',{}).get('working_servers',0))"

UserParameter=zbx1cpy.cluster.total_servers[*],cd /d "g:\Automation\zbx-1c-py" && "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -m zbx_1c metrics $1 | "g:\Automation\zbx-1c-py\.venv\Scripts\python.exe" -c "import sys,json; d=json.load(sys.stdin); print(d.get('metrics',{}).get('total_servers',0))"
